<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <title>TTAT Result Online ‚Äî ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡∏Å‡∏µ‡∏¨‡∏≤ (Fuzzy + Filter-first)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
  <style>
    :root{
      --bg:#0b2038; --panel:#0f2b4c; --muted:#9db0d1; --text:#e7f0ff; --accent:#2ea0ff;
      --row:#122c50; --row2:#123259; --border:#1d4672; --warn:#ffcc66;
    }
    *{box-sizing:border-box}  html,body{margin:0; font-family:Inter,system-ui,Arial}
    body{background:var(--bg); color:var(--text)}
    header{background:#062449; padding:18px 16px; font-size:20px; font-weight:700}
    .container{max-width:1100px; margin:28px auto; padding:0 16px}
    a.back{display:inline-block; color:var(--muted); text-decoration:none; margin-bottom:14px}
    .card{background:var(--panel); border:1px solid var(--border); border-radius:12px; padding:16px}
    .controls{display:flex; gap:10px; flex-wrap:wrap; margin-bottom:14px}
    input[type="text"]{background:#0b2241; color:var(--text); border:1px solid var(--border);
      padding:12px 14px; border-radius:10px; min-width:260px}
    button{background:#0f5130; border:1px solid #0f5130; color:#fff; padding:12px 18px;
      border-radius:10px; cursor:pointer; font-weight:600}
    button.secondary{background:#0b2241; border:1px solid var(--border)}
    button:hover{filter:brightness(1.03)}
    .muted{color:var(--muted); font-size:13px}
    .name{margin:8px 2px 14px; color:#bfe1ff}

    table{width:100%; border-collapse:collapse; font-size:14px; overflow:hidden; border-radius:10px}
    thead th{background:#0a2a53; text-align:left; padding:11px 12px; border-bottom:1px solid var(--border)}
    tbody td{padding:11px 12px; border-bottom:1px solid var(--border)}
    tbody tr{background:var(--row)}
    tbody tr:nth-child(even){background:var(--row2)}
    .warn{color:var(--warn); font-size:13px; margin-top:10px}
    .right{float:right; font-size:13px}
    .pill{display:inline-block; padding:6px 10px; border:1px solid var(--border); border-radius:999px; color:var(--muted)}
    .chips{display:flex; gap:8px; flex-wrap:wrap; margin:6px 0 10px}
    .chip{background:#0b2241; border:1px solid var(--border); padding:6px 10px; border-radius:999px; cursor:pointer}
    .chip:hover{filter:brightness(1.05)}

    /* ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏∞ hidden ‡πÇ‡∏î‡∏¢‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÇ‡∏´‡∏°‡∏î‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏ä‡∏∑‡πà‡∏≠) */
    .col-name{display:none}
    .show-name .col-name{display:table-cell}
  </style>
</head>
<body>
  <header>TTAT Result Online ‚Äî ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡∏Å‡∏µ‡∏¨‡∏≤</header>

  <div class="container">
    <a class="back" href="./index.html">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>

    <div class="card">
      <div class="controls">
        <input id="qName" type="text" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏• (‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô/‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏•‡∏≤‡∏î‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏î‡πâ ‡πÄ‡∏ä‡πà‡∏ô ‡∏†‡∏≤‡∏Ñ‡∏†‡∏°‡∏π‡∏¥)">
        <button id="btnSearch">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
        <button id="btnClear" class="secondary">‡∏•‡πâ‡∏≤‡∏á</button>
        <input id="qFilter" type="text" placeholder="‡∏Å‡∏£‡∏≠‡∏á‡∏Ñ‡∏≥‡πÉ‡∏ô ‚Äò‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‚Äô ‡∏´‡∏£‡∏∑‡∏≠ ‚Äò‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‚Äô (‡∏û‡∏¥‡∏°‡∏û‡πå ‚â• 2 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢)" style="flex:1 1 260px">
      </div>

      <div class="name" id="selName" hidden>
        ‡∏ô‡∏±‡∏Å‡∏Å‡∏µ‡∏¨‡∏≤: <span class="pill" id="selNameTxt"></span>
        <span class="right muted" id="countTxt"></span>
      </div>

      <!-- ‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥) -->
      <div id="suggestWrap" class="chips" style="display:none"></div>

      <div class="tablewrap">
        <table id="tbl">
          <thead>
            <tr>
              <th class="col-name" id="thName">‡∏ä‡∏∑‡πà‡∏≠ - ‡∏™‡∏Å‡∏∏‡∏•</th>
              <th style="width:120px">‡∏õ‡∏µ ‡∏à‡∏±‡∏î‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô</th>
              <th>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th>
              <th style="width:280px">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
              <th style="width:160px">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</th>
            </tr>
          </thead>
          <tbody id="rows">
            <tr><td colspan="5" class="muted">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‚Ä¶</td></tr>
          </tbody>
        </table>
        <div id="warn" class="warn" hidden></div>
      </div>
    </div>
  </div>

  <!-- PapaParse ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡πà‡∏≤‡∏ô CSV -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script>
    const CSV_URL = 'data.csv?v=1';

    const el = (id)=>document.getElementById(id);
    const $rows = el('rows');
    const $nameBox = el('selName');
    const $nameTxt = el('selNameTxt');
    const $countTxt = el('countTxt');
    const $warn = el('warn');
    const $suggest = el('suggestWrap');
    const $tbl = el('tbl');
    const $thName = el('thName');

    let DATA = [];
    let LOADED = false;

    const normalize = s => String(s||'')
      .replace(/\u00A0/g,' ')
      .replace(/\s+/g,' ')
      .trim()
      .toLowerCase();

    // --- Levenshtein / similarity (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö fuzzy name) ---
    function levenshtein(a,b){
      a = normalize(a); b = normalize(b);
      const m = a.length, n = b.length;
      if(m===0) return n; if(n===0) return m;
      const dp = Array.from({length:m+1}, (_,i)=>Array(n+1).fill(0));
      for(let i=0;i<=m;i++) dp[i][0]=i;
      for(let j=0;j<=n;j++) dp[0][j]=j;
      for(let i=1;i<=m;i++){
        for(let j=1;j<=n;j++){
          const cost = a[i-1]===b[j-1] ? 0 : 1;
          dp[i][j] = Math.min(dp[i-1][j] + 1, dp[i][j-1] + 1, dp[i-1][j-1] + cost);
        }
      }
      return dp[m][n];
    }
    function allowedTypos(len){ if(len<=4) return 1; if(len<=8) return 2; return 3; }
    function similarity(a,b){
      const d = levenshtein(a,b);
      const L = Math.max(normalize(a).length, normalize(b).length) || 1;
      return 1 - d / L;
    }

    async function loadCSV(){
      try{
        const res = await fetch(CSV_URL, {cache:'no-store'});
        if(!res.ok) throw new Error('HTTP '+res.status);
        const text = await res.text();
        const parsed = Papa.parse(text, {header:true, skipEmptyLines:true});

        DATA = parsed.data.map(r => ({
          name: (r['‡∏ä‡∏∑‡πà‡∏≠ - ‡∏™‡∏Å‡∏∏‡∏•'] ?? '').trim(),
          year: (r['‡∏õ‡∏µ ‡∏à‡∏±‡∏î‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô'] ?? '').toString().trim(),
          event: (r['‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£'] ?? '').trim(),
          type: (r['‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó'] ?? '').trim(),
          pos:  (r['‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á'] ?? '').trim()
        })).filter(r => r.name);

        LOADED = true;
        $rows.innerHTML = '<tr><td colspan="5" class="muted">‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠ ‚â• 2 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£ ‡∏´‡∏£‡∏∑‡∏≠ ‡∏Å‡∏£‡∏≠‡∏á‡∏Ñ‡∏≥ ‚â• 2 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£</td></tr>';
      }catch(err){
        console.error(err);
        $rows.innerHTML = '<tr><td colspan="5">‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</td></tr>';
        $warn.hidden = false;
        $warn.textContent = '‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÑ‡∏ü‡∏•‡πå data.csv ‡∏≠‡∏¢‡∏π‡πà‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ ‡πÅ‡∏•‡∏∞‡∏•‡∏≠‡∏á‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡πÉ‡∏´‡∏°‡πà';
      }
    }

    function renderRows(list, {showName}){
      // toggle ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ä‡∏∑‡πà‡∏≠
      if(showName){
        $tbl.classList.add('show-name');
      }else{
        $tbl.classList.remove('show-name');
      }

      if(!list.length){
        $rows.innerHTML = '<tr><td colspan="5" class="muted">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>';
        $countTxt.textContent = '';
        return;
      }
      list.sort((a,b)=> (Number(b.year)||0) - (Number(a.year)||0));
      const html = list.map(r=>`
        <tr>
          <td class="col-name">${showName ? (r.name||'-') : ''}</td>
          <td>${r.year || '-'}</td>
          <td>${r.event || '-'}</td>
          <td>${r.type || '-'}</td>
          <td>${r.pos  || '-'}</td>
        </tr>
      `).join('');
      $rows.innerHTML = html;
      $countTxt.textContent = `‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${list.length.toLocaleString('th-TH')} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
    }

    function showSuggestions(cands){
      if(!cands.length){ $suggest.style.display='none'; $suggest.innerHTML=''; return; }
      $suggest.style.display='flex';
      $suggest.innerHTML = cands.slice(0,8).map(c =>
        `<span class="chip" data-name="${c.name}">${c.name}</span>`
      ).join('');
      $suggest.querySelectorAll('.chip').forEach(chip=>{
        chip.addEventListener('click', ()=>{
          el('qName').value = chip.dataset.name;
          doSearch();  // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
        });
      });
    }

    function doSearch(){
      if(!LOADED) return;

      const qNameRaw = el('qName').value;
      const qName = normalize(qNameRaw);
      const qFilter = normalize(el('qFilter').value);

      // ‡∏Å‡∏£‡∏ì‡∏µ 1: ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏ä‡∏∑‡πà‡∏≠ (>=2 ‡∏ï‡∏±‡∏ß)
      if(qName.length >= 2){
        $nameBox.hidden = false;

        const namePool = [...new Set(DATA.map(x=>x.name))];
        const typoLimit = allowedTypos(qName.length);

        const scored = namePool.map(n => {
          const nn = normalize(n);
          const contains = nn.includes(qName) ? 1 : 0;
          const dist = levenshtein(qName, nn);
          const sim = similarity(qName, nn);
          return { name:n, contains, dist, sim };
        })
        .filter(s => s.contains || s.dist <= typoLimit || s.sim >= 0.7)
        .sort((a,b)=> (b.contains - a.contains) || (a.dist - b.dist) || (b.sim - a.sim));

        if(scored.length===0){
          $nameBox.hidden = true;
          showSuggestions([]);
          $rows.innerHTML = `<tr><td colspan="5" class="muted">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á ‚Äú${qNameRaw.trim()}‚Äù</td></tr>`;
          $countTxt.textContent = '';
          return;
        }

        const bestName = scored[0].name;
        let matchedNames = scored.map(s=>s.name);
        if(matchedNames.length > 12) matchedNames = matchedNames.slice(0,6);

        let out = DATA.filter(r => matchedNames.includes(r.name));
        if(qFilter){
          out = out.filter(r =>
            normalize(r.event).includes(qFilter) ||
            normalize(r.type).includes(qFilter)
          );
        }

        el('selNameTxt').textContent = bestName;
        renderRows(out, {showName:false});

        const uniqCount = new Set(matchedNames).size;
        $countTxt.textContent += ` ‚Ä¢ ${uniqCount} ‡∏ä‡∏∑‡πà‡∏≠`;

        const suggestions = scored.filter(s => s.name !== bestName).slice(0,8).map(s => ({name:s.name}));
        showSuggestions(suggestions);
        return;
      }

      // ‡∏Å‡∏£‡∏ì‡∏µ 2: ‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡πà‡∏≤‡∏á ‡πÅ‡∏ï‡πà‡∏Å‡∏£‡∏≠‡∏á‡∏Ñ‡∏≥ >= 2 ‡∏ï‡∏±‡∏ß ‚Üí ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÅ‡∏ö‡∏ö‡∏£‡∏ß‡∏°‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏ô ‡πÅ‡∏•‡∏∞‡πÇ‡∏ä‡∏ß‡πå‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ä‡∏∑‡πà‡∏≠
      if(qFilter.length >= 2){
        $nameBox.hidden = true;
        showSuggestions([]);

        const out = DATA.filter(r =>
          normalize(r.event).includes(qFilter) ||
          normalize(r.type).includes(qFilter)
        );

        renderRows(out, {showName:true});
        return;
      }

      // ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡∏û‡∏≠‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
      $nameBox.hidden = true;
      showSuggestions([]);
      $rows.innerHTML = '<tr><td colspan="5" class="muted">‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠ ‚â• 2 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£ ‡∏´‡∏£‡∏∑‡∏≠ ‡∏Å‡∏£‡∏≠‡∏á‡∏Ñ‡∏≥ ‚â• 2 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£</td></tr>';
      $countTxt.textContent = '';
    }

    function clearAll(){
      el('qName').value = '';
      el('qFilter').value = '';
      $nameBox.hidden = true;
      showSuggestions([]);
      $rows.innerHTML = '<tr><td colspan="5" class="muted">‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠ ‚â• 2 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£ ‡∏´‡∏£‡∏∑‡∏≠ ‡∏Å‡∏£‡∏≠‡∏á‡∏Ñ‡∏≥ ‚â• 2 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£</td></tr>';
      $countTxt.textContent = '';
      el('qName').focus();
    }

    // Events
    document.addEventListener('DOMContentLoaded', loadCSV);
    el('btnSearch').addEventListener('click', doSearch);
    el('btnClear').addEventListener('click', clearAll);
    el('qName').addEventListener('keydown', e => { if(e.key==='Enter') doSearch(); });
    el('qName').addEventListener('input', () => {
      if(el('qName').value.trim().length >= 2) doSearch();
      else if(el('qFilter').value.trim().length >= 2) doSearch();
    });
    // üîπ ‡∏û‡∏¥‡∏°‡∏û‡πå‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏á‡∏Ñ‡∏≥ ‚â• 2 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£ ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ‡πÅ‡∏°‡πâ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠
    el('qFilter').addEventListener('input', () => {
      const v = el('qFilter').value.trim();
      if(v.length >= 2 || el('qName').value.trim().length >= 2) doSearch();
      else{
        $rows.innerHTML = '<tr><td colspan="5" class="muted">‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠ ‚â• 2 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£ ‡∏´‡∏£‡∏∑‡∏≠ ‡∏Å‡∏£‡∏≠‡∏á‡∏Ñ‡∏≥ ‚â• 2 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£</td></tr>';
        $countTxt.textContent = '';
      }
    });
  </script>
</body>
</html>
